(()=>{"use strict";function e(e,t,n,r,o,i,c){var u=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),a=u.querySelector(".card__delete-button"),s=u.querySelector(".card__image"),l=u.querySelector(".card__like-button"),d=u.querySelector(".quantity__likes");return e!==t.owner._id&&a.remove(),s.src=t.link,s.alt=t.name,u.querySelector(".card__title").textContent=t.name,d.textContent=t.likes.length,t.likes.some((function(t){t._id===e&&l.classList.add("card__like-button_is-active")})),a.addEventListener("click",(function(){n(t._id,u)})),s.addEventListener("click",(function(){r(t)})),l.addEventListener("click",(function(e){o(t._id,d,c,i,l,e)})),u}function t(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function r(e){e.target.classList.contains("popup_is-opened")&&n(e.target)}function o(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))}var i=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))},c=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach((function(n){var r=e.querySelector(".".concat(n.id,"-error"));n.classList.remove(t.inputErrorClass),r.classList.remove(t.errorClass),r.textContent="",n.setCustomValidity("")}));var r=e.querySelector(t.submitButtonSelector);i(n,r,t)},u={baseUrl:"https://nomoreparties.co/v1/".concat("wff-cohort-18"),headers:{authorization:"89de41b9-e6fb-4654-a6fb-9e2e81d88a46","Content-Type":"application/json"}};function a(e,t){return e.ok?e.json():Promise.reject(t)}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var l=document.querySelector(".places__list"),d=document.querySelector(".profile__edit-button"),p=document.querySelector(".profile__add-button"),f=document.querySelector(".profile__image"),m=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_new-card"),_=document.querySelector(".popup_type_new-avatar"),y=document.querySelector(".popup_type_image"),b=document.querySelector(".popup__image"),h=document.querySelector(".popup__caption"),S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function C(e){b.src=e.link,b.alt=e.name,h.textContent=e.name,t(y)}d.addEventListener("click",(function(){t(m),A.value=q.textContent,g.value=E.textContent,c(m,S)})),p.addEventListener("click",(function(){t(v),c(v,S)})),f.addEventListener("click",(function(){t(_),c(_,S)})),document.querySelectorAll(".popup").forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){n(e)})),e.addEventListener("click",r)}));var q=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),L=document.forms["edit-profile"],A=L.elements.name,g=L.elements.description;function k(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function x(e,t){e.preventDefault(),k(!0,t),t.setAttribute("disabled",!0),t.setAttribute("style","pointer-events: none")}L.addEventListener("submit",(function(e){var t,r=e.target.querySelector(".popup__button");x(e,r),(t={name:A.value,about:g.value},fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify(t)}).then((function(e){return a(e,"Не удается сохранить, попробуйте позже")}))).then((function(){q.textContent=A.value,E.textContent=g.value,n(m),k(!1,r),r.removeAttribute("disabled",!0),r.removeAttribute("style","pointer-events: none")})).catch((function(e){r.textContent=e,setTimeout((function(){return k(!1,r)}),1e3),setTimeout((function(){r.removeAttribute("disabled",!0),r.removeAttribute("style","pointer-events: none")}),1e3)}))}));var T=document.forms["new-avatar"],w=T.elements.link;T.addEventListener("submit",(function(e){var t,r=e.target.querySelector(".popup__button");x(e,r),(t={avatar:w.value},fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify(t)}).then((function(e){return a(e,"Не удается сохранить, попробуйте позже")}))).then((function(){f.setAttribute("style","background-image: url('".concat(w.value,"')")),n(_),e.target.reset(),k(!1,r),r.removeAttribute("disabled",!0),r.removeAttribute("style","pointer-events: none")})).catch((function(e){r.textContent=e,setTimeout((function(){return k(!1,r)}),1e3),setTimeout((function(){r.removeAttribute("disabled",!0),r.removeAttribute("style","pointer-events: none")}),1e3)}))}));var U=document.forms["new-place"],j=U.elements["place-name"],O=U.elements.link;U.addEventListener("submit",(function(r){var o,i=r.target.querySelector(".popup__button");x(r,i),(o={name:j.value,link:O.value},fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify(o)}).then((function(e){return a(e,"Не удается сохранить, попробуйте позже")}))).then((function(o){l.prepend(e($,o,H,C,z,t,n)),n(v),r.target.reset(),k(!1,i),i.removeAttribute("disabled",!0),i.removeAttribute("style","pointer-events: none")})).catch((function(e){i.textContent=e,setTimeout((function(){return k(!1,i)}),1e3),setTimeout((function(){i.removeAttribute("disabled",!0),i.removeAttribute("style","pointer-events: none")}),1e3)}))}));var B,P=document.querySelector(".popup_type_delete-card"),D=document.forms["delete-card"],M=P.querySelector(".popup__button"),N=document.querySelector(".popup_type_error"),I=N.querySelector(".popup__title"),J=null,V=null,H=function(e,n){t(P),J=e,V=n};function z(e,t,n,r,o,i){var c;o.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(u.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return a(e,"Пока недоступно, попробуйте позже")}))}(e).then((function(e){t.textContent=e.likes.length,i.target.classList.remove("card__like-button_is-active")})).catch((function(e){r(N),I.textContent=e,setTimeout((function(){return n(N)}),1500)})):(c=e,fetch("".concat(u.baseUrl,"/cards/likes/").concat(c),{method:"PUT",headers:u.headers}).then((function(e){return a(e,"Пока недоступно, попробуйте позже")}))).then((function(e){t.textContent=e.likes.length,i.target.classList.add("card__like-button_is-active")})).catch((function(e){r(N),I.textContent=e,setTimeout((function(){return n(N)}),1500)}))}D.addEventListener("submit",(function(){var e;(e=J,fetch("".concat(u.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return a(e,"Не удается удалить карточку, попробуйте позже")}))).then((function(){V.remove(),n(P)})).catch((function(e){M.textContent=e,setTimeout((function(){M.textContent="Да"}),1e3)}))})),B=S,Array.from(document.querySelectorAll(B.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);i(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.classList.add(r.errorClass),o.textContent=n}(e,t,t.validationMessage,n)}(e,o,t),i(n,r,t)}))}))}(e,B)}));var $=null,F=document.querySelector(".profile__info");Promise.all([fetch("".concat(u.baseUrl,"/users/me"),{headers:u.headers}).then((function(e){return a(e,"Упсс, возникла ошибка. Попробуйте позже")})),fetch("".concat(u.baseUrl,"/cards"),{headers:u.headers}).then((function(e){return a(e,"Упсс, возникла ошибка. Попробуйте позже")}))]).then((function(r){var o,i,c=(i=2,function(e){if(Array.isArray(e))return e}(o=r)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,c,u=[],a=!0,s=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(r=i.call(n)).done)&&(u.push(r.value),u.length!==t);a=!0);}catch(e){s=!0,o=e}finally{try{if(!a&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(s)throw o}}return u}}(o,i)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(o,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=c[0],a=c[1];q.textContent=u.name,E.textContent=u.about,f.setAttribute("style","background-image: url('".concat(u.avatar,"')")),$=u._id,a.forEach((function(r){l.append(e($,r,H,C,z,t,n))}))})).catch((function(e){F.removeAttribute("class"),q.textContent=e,d.remove(),p.remove()}))})();